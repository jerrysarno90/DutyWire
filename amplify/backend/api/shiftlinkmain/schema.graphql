 type RosterEntry @model
  @auth(rules: [
    { allow: owner, ownerField: "badgeNumber" },
    { allow: groups, groups: ["Admin"] },
    { allow: groups, groups: ["Supervisor"], operations: [read] }
  ]) {
  id: ID!
  orgId: String! @index(name: "rosterEntriesByOrg", queryField: "rosterEntriesByOrg", sortKeyFields: ["startsAt"])
  badgeNumber: String!
    @auth(rules: [
      { allow: owner, ownerField: "badgeNumber", operations: [read] },
      { allow: groups, groups: ["Admin"] },
      { allow: groups, groups: ["Supervisor"], operations: [read] }
    ])
  shift: String
  startsAt: AWSDateTime!
  endsAt: AWSDateTime!
  notes: String
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
 }

 type Vehicle @model
  @auth(rules: [
    { allow: groups, groups: ["Admin"] },
    { allow: groups, groups: ["Supervisor"], operations: [read, update] },
    { allow: private, operations: [read] }
  ]) {
  id: ID!
  orgId: String! @index(name: "vehiclesByOrg", queryField: "vehiclesByOrg", sortKeyFields: ["callsign"])
  callsign: String!
  make: String
  model: String
  plate: String
  inService: Boolean
  createdAt: AWSDateTime
  updatedAt: AWSDateTime
 }

 type CalendarEvent @model
  @auth(rules: [
    { allow: owner, ownerField: "ownerId" },
    { allow: groups, groups: ["Admin", "Supervisor"] },
    { allow: private, operations: [read] }
  ]) {
  id: ID!
  orgId: String! @index(name: "eventsByOrg", queryField: "calendarEventsByOrg", sortKeyFields: ["startsAt"])
  ownerId: String!
    @index(name: "eventsByOwner", queryField: "calendarEventsByOwner", sortKeyFields: ["startsAt"])
    @auth(rules: [
      { allow: owner, ownerField: "ownerId", operations: [read] },
      { allow: groups, groups: ["Admin", "Supervisor"] },
      { allow: private, operations: [read] }
    ])
  title: String!
  category: String!
  color: String!
  notes: String
  startsAt: AWSDateTime!
  endsAt: AWSDateTime!
  reminderMinutesBefore: Int
  createdAt: AWSDateTime @aws_cognito_user_pools
  updatedAt: AWSDateTime @aws_cognito_user_pools
 }

 type OfficerAssignment @model
  @aws_iam
  @auth(rules: [
    { allow: owner, ownerField: "badgeNumber", operations: [read] },
    { allow: groups, groups: ["Admin"] },
    { allow: groups, groups: ["Supervisor"], operations: [read, update] }
  ]) {
  id: ID!
  orgId: String! @index(name: "assignmentsByOrg", queryField: "assignmentsByOrg", sortKeyFields: ["updatedAt"])
  badgeNumber: String! @index(name: "assignmentsByOfficer", queryField: "assignmentsByOfficer", sortKeyFields: ["updatedAt"])
  title: String!
  detail: String
  location: String
  notes: String
  createdAt: AWSDateTime @aws_cognito_user_pools
  updatedAt: AWSDateTime @aws_cognito_user_pools
 }

 enum OvertimeScenario {
  PATROL_SHORT_SHIFT
  SERGEANT_SHORT_SHIFT
  SPECIAL_EVENT
 OTHER_OVERTIME
}

enum OvertimePostingState {
 OPEN
 FILLED
 CLOSED
}

enum OvertimePolicy {
  FIRST_COME_FIRST_SERVED
  SENIORITY
}

enum OvertimeSignupStatus {
  PENDING
  CONFIRMED
  WITHDRAWN
  FORCED
 }

 type OvertimePosting @model
  @auth(rules: [
    { allow: owner, ownerField: "createdBy" },
    { allow: groups, groups: ["Admin", "Supervisor"] }
  ]) {
  id: ID!
  orgId: String! @index(name: "overtimeByOrg", queryField: "overtimePostingsByOrg", sortKeyFields: ["startsAt"])
  title: String!
  location: String
  scenario: OvertimeScenario!
  startsAt: AWSDateTime!
  endsAt: AWSDateTime!
  slots: Int!
  policy: OvertimePolicy!
  notes: String
  deadline: AWSDateTime
  state: OvertimePostingState!
  createdBy: String!
  signups: [OvertimeSignup] @hasMany(indexName: "signupsByPosting", fields: ["id"])
  createdAt: AWSDateTime @aws_cognito_user_pools
  updatedAt: AWSDateTime @aws_cognito_user_pools
 }

 type OvertimeSignup @model
  @auth(rules: [
    { allow: owner, ownerField: "officerId" },
    { allow: groups, groups: ["Admin", "Supervisor"] }
  ]) {
  id: ID!
  postingId: ID! @index(name: "signupsByPosting", queryField: "signupsByPosting", sortKeyFields: ["submittedAt"])
  orgId: String! @index(name: "signupsByOrg", queryField: "overtimeSignupsByOrg", sortKeyFields: ["submittedAt"])
  officerId: String! @index(name: "signupsByOfficer", queryField: "overtimeSignupsByOfficer", sortKeyFields: ["status"])
  status: OvertimeSignupStatus!
  rank: String
  rankPriority: Int
  badgeNumber: String
  tieBreakerKey: String
  submittedAt: AWSDateTime!
  forcedBy: String
  forcedReason: String
  notes: String
  createdAt: AWSDateTime @aws_cognito_user_pools
  updatedAt: AWSDateTime @aws_cognito_user_pools
 }

 enum NotificationPlatform {
  IOS
  ANDROID
 }

 enum NotificationCategory {
  OVERTIME_POSTED
  OVERTIME_REMINDER
  OVERTIME_FORCE_ASSIGN
  SQUAD_ALERT
  TASK_ALERT
  BULLETIN
 }

type NotificationEndpoint @model
  @aws_iam
  @auth(rules: [
    { allow: owner, ownerField: "userId" },
    { allow: groups, groups: ["Admin", "Supervisor"], operations: [read] }
  ]) {
  id: ID!
  orgId: String @index(name: "notificationEndpointsByOrg", queryField: "notificationEndpointsByOrg", sortKeyFields: ["updatedAt"])
  userId: String! @index(name: "endpointsByUser", queryField: "notificationEndpointsByUser", sortKeyFields: ["updatedAt"])
  deviceToken: String!
  platform: NotificationPlatform!
  deviceName: String
  enabled: Boolean! @default(value: "true")
  platformEndpointArn: String
  lastUsedAt: AWSDateTime
  createdAt: AWSDateTime @aws_cognito_user_pools
  updatedAt: AWSDateTime @aws_cognito_user_pools
 }

 type NotificationMessage @model
  @auth(rules: [
    { allow: groups, groups: ["Admin", "Supervisor"] }
  ]) {
  id: ID!
  orgId: String! @index(name: "messagesByOrg", queryField: "notificationMessagesByOrg", sortKeyFields: ["createdAt"])
  title: String!
  body: String!
  category: NotificationCategory!
  recipients: [String!]!
  metadata: AWSJSON
  createdBy: String!
  createdAt: AWSDateTime @aws_cognito_user_pools
  updatedAt: AWSDateTime @aws_cognito_user_pools
 }

type NotificationPreference @model
  @auth(rules: [
    { allow: owner, ownerField: "userId" },
    { allow: groups, groups: ["Admin", "Supervisor"], operations: [read] }
  ]) {
  id: ID!
  userId: String! @index(name: "notificationPreferencesByUser", queryField: "notificationPreferencesByUser")
  generalBulletin: Boolean! @default(value: "true")
  taskAlert: Boolean! @default(value: "true")
  overtime: Boolean! @default(value: "true")
  squadMessages: Boolean! @default(value: "true")
  other: Boolean! @default(value: "true")
  contactPhone: String
  contactEmail: String
  backupEmail: String
  createdAt: AWSDateTime @aws_cognito_user_pools
  updatedAt: AWSDateTime @aws_cognito_user_pools
}

type Squad @model
  @auth(rules: [
    { allow: private, provider: userPools, operations: [read] },
    { allow: groups, provider: userPools, groups: ["AgencyManager", "Admin"] },
    { allow: groups, provider: userPools, groups: ["Supervisor"], operations: [read] },
    { allow: private, provider: iam, operations: [create, read, update, delete] }
  ]) {
  id: ID!
  orgId: String! @index(name:"squadsByOrg", sortKeyFields:["name"], queryField:"squadsByOrg")
  name: String!
  bureau: String!
  shift: String
  notes: String
  isActive: Boolean! @default(value: "true")
  memberships: [SquadMembership] @hasMany(indexName: "membershipBySquad", fields: ["id"])
  createdAt: AWSDateTime @aws_cognito_user_pools @auth(rules:[{ allow: private, provider: iam, operations:[read] }])
  updatedAt: AWSDateTime @aws_cognito_user_pools @auth(rules:[{ allow: private, provider: iam, operations:[read] }])
}

type SquadMembership @model
  @auth(rules: [
    { allow: private, provider: userPools, operations: [read] },
    { allow: groups, provider: userPools, groups: ["AgencyManager", "Admin"] },
    { allow: groups, provider: userPools, groups: ["Supervisor"], operations: [read] },
    { allow: owner, ownerField: "userId", operations: [read] },
    { allow: private, provider: iam, operations: [create, read, update, delete] }
  ]) {
  id: ID!
  squadId: ID! @index(name: "membershipBySquad", queryField: "squadMembershipsBySquad")
  userId: String! @index(name: "membershipByUser", queryField: "squadMembershipsByUser")
  roleInSquad: SquadRole!
  isPrimary: Boolean! @default(value: "true")
  isActive: Boolean! @default(value: "true")
  createdAt: AWSDateTime @aws_cognito_user_pools @auth(rules:[{ allow: private, provider: iam, operations:[read] }])
  updatedAt: AWSDateTime @aws_cognito_user_pools @auth(rules:[{ allow: private, provider: iam, operations:[read] }])
}

enum SquadRole {
  SUPERVISOR
  OFFICER
}

type NotificationReceipt @model
  @auth(rules: [
    { allow: owner, ownerField: "userId" },
    { allow: groups, groups: ["Admin", "Supervisor"], operations: [read] }
  ]) {
  id: ID!
  notificationId: ID!
    @index(name: "notificationReceiptsByNotification", queryField: "notificationReceiptsByNotification", sortKeyFields: ["userId"])
  userId: String!
    @index(name: "notificationReceiptsByUser", queryField: "notificationReceiptsByUser", sortKeyFields: ["notificationId"])
  orgId: String!
  isRead: Boolean! @default(value: "false")
  readAt: AWSDateTime
  createdAt: AWSDateTime @aws_cognito_user_pools
  updatedAt: AWSDateTime @aws_cognito_user_pools
}

input OvertimeNotificationInput {
  orgId: String!
  recipients: [String!]!
  title: String!
  body: String!
  category: NotificationCategory!
  postingId: ID
  metadata: AWSJSON
 }

 type NotificationSendResult {
  success: Boolean!
  delivered: Int
  recipientCount: Int
  message: String
 }

type Mutation {
  notifyOvertimeEvent(input: OvertimeNotificationInput!): NotificationSendResult
    @function(name: "overtimeNotifier-${env}")
  sendNotification(input: OvertimeNotificationInput!): NotificationSendResult
    @function(name: "overtimeNotifier-${env}")
}
